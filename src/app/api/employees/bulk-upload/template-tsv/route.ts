import { NextRequest, NextResponse } from 'next/server';

export async function GET(request: NextRequest) {
  try {
    // Create template data
    const templateData = [
      // Instructions
      [
        'ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª: Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù…ÙŠØ²Ø© Ø¨Ù€ (*) - Ù„Ø§ ØªØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© - Ø§Ø³ØªØ®Ø¯Ù… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® mm/dd/yyyy',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        ''
      ],
      // Empty row
      ['', '', '', '', '', '', '', '', '', '', '', '', ''],
      // Headers
      [
        'Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù *',
        'Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù *',
        'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *',
        'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        'Ø§Ù„Ø¬Ù†Ø³ÙŠØ© *',
        'Ø§Ù„Ù…Ù†ØµØ¨',
        'Ø§Ù„Ù…Ø¤Ø³Ø³Ø© / Ø§Ù„ÙƒÙÙŠÙ„',
        'Ø±Ø§ØªØ¨',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø±Ø®ØµØ© Ø§Ù„Ø¹Ù…Ù„',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­ÙŠØ©'
      ],
      // Format examples
      [
        'Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
        'Ù…Ø«Ø§Ù„: EMP-001',
        'Ù…Ø«Ø§Ù„: 0501234567',
        'Ù…Ø«Ø§Ù„: ahmed@company.com',
        'Ù…Ø«Ø§Ù„: Ø³Ø¹ÙˆØ¯ÙŠ',
        'Ù…Ø«Ø§Ù„: Ù…Ø·ÙˆØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª',
        'Ù…Ø«Ø§Ù„: Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©',
        'Ù…Ø«Ø§Ù„: 8000',
        'Ù…Ø«Ø§Ù„: 12/31/2025',
        'Ù…Ø«Ø§Ù„: 06/30/2025',
        'Ù…Ø«Ø§Ù„: 12/31/2026',
        'Ù…Ø«Ø§Ù„: 03/15/2025',
        'Ù…Ø«Ø§Ù„: 09/20/2025'
      ],
      // Empty row
      ['', '', '', '', '', '', '', '', '', '', '', '', ''],
      // Sample data 1
      [
        'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø£Ø­Ù…Ø¯',
        'EMP-001',
        '0501234567',
        'ahmed.mohammed@company.com',
        'Ø³Ø¹ÙˆØ¯ÙŠ',
        'Ù…Ø·ÙˆØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø£ÙˆÙ„',
        'Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©',
        '8000',
        '12/31/2025',
        '06/30/2025',
        '12/31/2026',
        '03/15/2025',
        '09/20/2025'
      ],
      // Sample data 2
      [
        'ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯ Ø³Ø§Ù„Ù… Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ',
        'EMP-002',
        '0509876543',
        'fatima.ahmed@company.com',
        'Ù…ØµØ±ÙŠ',
        'Ù…Ø­Ø§Ø³Ø¨Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©',
        'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©',
        '6500',
        '08/15/2025',
        '03/20/2025',
        '01/31/2026',
        '11/10/2024',
        '07/05/2025'
      ],
      // Sample data 3
      [
        'Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ',
        'EMP-003',
        '0551122334',
        'mohammed.abdullah@company.com',
        'ÙŠÙ…Ù†ÙŠ',
        'Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø¯Ù†ÙŠ',
        'Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰',
        '12000',
        '04/22/2025',
        '10/15/2025',
        '05/30/2026',
        '01/20/2025',
        '12/12/2024'
      ],
      // Sample data 4
      [
        'Ù†ÙˆØ±Ø§ Ø³Ø§Ù„Ù… Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',
        'EMP-004',
        '0543216789',
        'nora.salem@company.com',
        'Ø³Ø¹ÙˆØ¯ÙŠ',
        'Ù…ØµÙ…Ù…Ø© Ø¬Ø±Ø§ÙÙŠÙƒ',
        'ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ',
        '7500',
        '11/20/2025',
        '08/30/2025',
        '09/15/2026',
        '04/25/2025',
        '12/10/2025'
      ],
      // Sample data 5
      [
        'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
        'EMP-005',
        '0512345678',
        'khalid.abdulaziz@company.com',
        'ÙƒÙˆÙŠØªÙŠ',
        'Ù…Ù‡Ù†Ø¯Ø³ Ø´Ø¨ÙƒØ§Øª',
        'Ø´Ø±ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©',
        '13500',
        '05/10/2025',
        '03/25/2025',
        '08/20/2026',
        '02/15/2025',
        '07/05/2025'
      ]
    ];

    // Convert to TSV format (Tab Separated Values) - works better with Excel
    const tsvContent = templateData
      .map(row => row.join('\t'))
      .join('\n');

    // Add BOM for proper Arabic display in Excel
    const bom = '\uFEFF';
    const finalContent = bom + tsvContent;

    return new NextResponse(finalContent, {
      status: 200,
      headers: {
        'Content-Type': 'text/tab-separated-values; charset=utf-8',
        'Content-Disposition': 'attachment; filename="employee-template.txt"',
        'Cache-Control': 'no-cache',
      },
    });

  } catch (error) {
    console.error('Error generating template:', error);
    return NextResponse.json(
      { success: false, error: 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨' },
      { status: 500 }
    );
  }
}
